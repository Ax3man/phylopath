<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparing causal models of binary traits using phylopath • phylopath</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Comparing causal models of binary traits using phylopath">
<meta property="og:description" content="phylopath">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">phylopath</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro_to_phylopath.html">Get started</a>
</li>
<li>
  <a href="../articles/binary_models.html">Binary data</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Ax3man/phylopath" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Comparing causal models of binary traits using
phylopath</h1>
                        <h4 data-toc-skip class="author">Wouter van der
Bijl</h4>
            
            <h4 data-toc-skip class="date">2024-06-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Ax3man/phylopath/blob/HEAD/vignettes/binary_models.Rmd" class="external-link"><code>vignettes/binary_models.Rmd</code></a></small>
      <div class="hidden name"><code>binary_models.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette gives a short example of how PPA can be applied to
binary data sets using <code>phylopath</code>. A longer example with
more explanation of the code can be found in the other vignette, “intro
to phylopath”.</p>
<p><strong>Important notes</strong>:</p>
<p>There has been some discussion concerning how to best perform
logistic regression with phylogenetic correction. I take no position on
this matter. This package uses <code><a href="https://rdrr.io/pkg/phylolm/man/phyloglm.html" class="external-link">phylolm::phyloglm</a></code>, written
by Lam Si Tung Ho, Robert Lachlan, Rachel Feldman and Cécile Ané.
<code>phylopath</code>’s accuracy is directly dependent on the accuracy
of that function, and if you don’t trust <code>phyloglm</code> you
should not trust binary models used in <code>phylo_path</code>.</p>
<p><code><a href="https://rdrr.io/pkg/phylolm/man/phyloglm.html" class="external-link">phylolm::phyloglm</a></code> performs checks for model convergence.
In practice, these often fail. Especially in <code>phylopath</code>,
were we often fit many models, it is likely that at least one model
fails these checks and generates a warning. You can see the warnings
using <code>check_warnings()</code>. You can try changing to the second
method (<code>method = 'logistic_IG10'</code>), or passing parameters
like <code>btol</code> and <code>log.alpha.bound</code> (see
<code><a href="https://rdrr.io/pkg/phylolm/man/phyloglm.html" class="external-link">?phylolm::phyloglm</a></code>). These parameters are then applied to
all models. Another option is to use the <code>phylosem</code> package,
which supports both Binomial and Poisson errors with a different
implementation.</p>
<p><em>The example below currently generates such warnings, should not
be trusted, and is only presented as an example.</em></p>
<p>If you have useful opinions or information on these points, feel free
to contact me.</p>
</div>
<div class="section level2">
<h2 id="example-analysis">Example analysis<a class="anchor" aria-label="anchor" href="#example-analysis"></a>
</h2>
<div class="section level4">
<h4 id="data-and-hypotheses">Data and hypotheses<a class="anchor" aria-label="anchor" href="#data-and-hypotheses"></a>
</h4>
<p>This recreates the analysis from the following paper:</p>
<blockquote>
<p>Dey CJ, O’Connor CM, Wilkinson H, Shultz S, Balshine S &amp;
Fitzpatrick JL. 2017. Direct benefits and evolutionary transitions to
complex societies. Nature Ecology &amp; Evolution. 0137.</p>
</blockquote>
<p>This is, to my knowledge, the first study to employ PPA on binary
traits.</p>
<p>The study investigates the evolution of cooperative breeding in
cichlids. In short (my summary), there has been intense debate about
what factors drive species towards evolving systems of cooperative
breeding. Many have argued (and provided evidence in birds and mammals)
that cooperative breeding chiefly evolves from monogamous mating systems
because helpers can gain indirect fitness benefits through kin
selection. However, a non-exclusive alternative hypothesis is that
direct benefits due to ecological factors may be important and provide
direct benefits. Therefore, both hypotheses should be considered at the
same time.</p>
<p>The data is included in this paper as <code>cichlids</code> and
<code>cichlids_tree</code></p>
<p>It contains five variables:</p>
<ul>
<li>C: Cooperative breeding, cooperative or non-cooperative.</li>
<li>M: Mating system, monogamous or non-monogamous.</li>
<li>P: Parental care, maternal or biparental.</li>
<li>G: Social grouping, grouping or non-grouping.</li>
<li>D: Diet, piscivore or non-piscivore.</li>
</ul>
<p>Under the indirect fitness hypothesis, monogamy is expected to be a
major driver of cooperative breeding, while group living, biparental
care and diet type may be important contributors towards a direct
benefits scenario.</p>
</div>
<div class="section level4">
<h4 id="defining-the-causal-models">Defining the causal models<a class="anchor" aria-label="anchor" href="#defining-the-causal-models"></a>
</h4>
<p>Following the paper in question, we define 12 putative causal
models.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ax3man.github.io/phylopath/" class="external-link">phylopath</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_model_set.html">define_model_set</a></span><span class="op">(</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">C</span><span class="op">~</span><span class="va">M</span><span class="op">+</span><span class="va">D</span><span class="op">)</span>,</span>
<span>  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">C</span><span class="op">~</span><span class="va">D</span><span class="op">)</span>,</span>
<span>  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">C</span><span class="op">~</span><span class="va">D</span>, <span class="va">P</span><span class="op">~</span><span class="va">M</span><span class="op">)</span>,</span>
<span>  D <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">C</span><span class="op">~</span><span class="va">D</span>, <span class="va">M</span><span class="op">~</span><span class="va">P</span>, <span class="va">G</span><span class="op">~</span><span class="va">P</span><span class="op">)</span>,</span>
<span>  E <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">C</span><span class="op">~</span><span class="va">D</span>, <span class="va">P</span><span class="op">~</span><span class="va">M</span>, <span class="va">G</span><span class="op">~</span><span class="va">P</span><span class="op">)</span>,</span>
<span>  F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">C</span><span class="op">~</span><span class="va">D</span>, <span class="va">P</span><span class="op">~</span><span class="va">M</span><span class="op">+</span><span class="va">G</span><span class="op">)</span>,</span>
<span>  G <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">C</span><span class="op">~</span><span class="va">D</span>, <span class="va">M</span><span class="op">~</span><span class="va">P</span>, <span class="va">P</span><span class="op">~</span><span class="va">G</span><span class="op">)</span>,</span>
<span>  H <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">C</span><span class="op">~</span><span class="va">D</span>, <span class="va">M</span><span class="op">~</span><span class="va">P</span><span class="op">)</span>,</span>
<span>  I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">C</span><span class="op">~</span><span class="va">D</span>, <span class="va">M</span><span class="op">~</span><span class="va">M</span>, <span class="va">G</span><span class="op">~</span><span class="va">P</span><span class="op">)</span>,</span>
<span>  J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">M</span><span class="op">~</span><span class="va">P</span>, <span class="va">G</span><span class="op">~</span><span class="va">D</span><span class="op">)</span>,</span>
<span>  K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">P</span><span class="op">~</span><span class="va">M</span>, <span class="va">G</span><span class="op">~</span><span class="va">D</span><span class="op">)</span>,</span>
<span>  L <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">C</span><span class="op">~</span><span class="va">M</span><span class="op">+</span><span class="va">D</span>, <span class="va">P</span><span class="op">~</span><span class="va">M</span><span class="op">+</span><span class="va">G</span><span class="op">)</span>,</span>
<span>  .common <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">C</span><span class="op">~</span><span class="va">P</span><span class="op">+</span><span class="va">G</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_model_set.html">plot_model_set</a></span><span class="op">(</span><span class="va">models</span>, algorithm <span class="op">=</span> <span class="st">'kk'</span><span class="op">)</span></span></code></pre></div>
<p><img src="binary_models_files/figure-html/define_models-1.png" width="6000" height="600px" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="comparing-the-models">Comparing the models<a class="anchor" aria-label="anchor" href="#comparing-the-models"></a>
</h4>
<p>Now that we have our models, data and a tree, we can compare the
models using <code>phylo_path</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">cichlids_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phylo_path.html">phylo_path</a></span><span class="op">(</span><span class="va">models</span>, <span class="va">cichlids</span>, <span class="va">cichlids_tree</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 15 rows were dropped because they contained NA values.</span></span></code></pre>
<pre><code><span><span class="co">## Pruned tree to drop species not included in `data`.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in phylo_path(models, cichlids, cichlids_tree): Some models produced warnings. Use `show_warnings()` to view them.</span></span></code></pre>
<pre><code><span><span class="co">## A phylogenetic path analysis, on the variables:</span></span>
<span><span class="co">##  Continuous:   </span></span>
<span><span class="co">##  Binary:      G P D M C </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Evaluated for these models: A B C D E F G H I J K L </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Containing 67 phylogenetic regressions, of which 22 unique</span></span></code></pre>
<p>Note that three messages are printed. This is because there are
missing values in our data set that are first being removed. Also, since
the tree includes species for which data is missing, the tree had to be
pruned. This is done automatically with a message to the user. You
should check whether the amount of data removed is correct.</p>
<p>The third messages notes that warnings have been generated, see the
<strong>Important notes</strong> at the start of this vignette. I will
continue with these results here, but <em>models with warnings should
not be trusted</em>.</p>
<p><code>phylo_path</code> notes that indeed all variables are
binary.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cichlids_results</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   model k  q     C       p CICc delta_CICc        l        w</span></span>
<span><span class="co">## F     F 5 10  7.95 0.63385 33.1       0.00 1.000000 0.511385</span></span>
<span><span class="co">## L     L 4 11  6.66 0.57358 34.9       1.88 0.390236 0.199561</span></span>
<span><span class="co">## G     G 5 10 10.94 0.36231 36.1       2.99 0.224235 0.114670</span></span>
<span><span class="co">## E     E 5 10 11.63 0.31052 36.7       3.68 0.158648 0.081130</span></span>
<span><span class="co">## D     D 5 10 11.73 0.30322 36.9       3.79 0.150632 0.077031</span></span>
<span><span class="co">## C     C 6  9 18.91 0.09081 41.0       7.93 0.018945 0.009688</span></span>
<span><span class="co">## H     H 6  9 20.40 0.05992 42.5       9.42 0.008987 0.004596</span></span>
<span><span class="co">## I     I 6  9 23.79 0.02170 45.9      12.82 0.001646 0.000842</span></span>
<span><span class="co">## K     K 6  9 25.37 0.01316 47.5      14.40 0.000748 0.000382</span></span>
<span><span class="co">## J     J 6  9 25.86 0.01124 47.9      14.88 0.000586 0.000300</span></span>
<span><span class="co">## B     B 7  8 28.84 0.01099 48.0      14.97 0.000560 0.000287</span></span>
<span><span class="co">## A     A 6  9 27.55 0.00643 49.6      16.58 0.000251 0.000129</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></code></pre></div>
<p><img src="binary_models_files/figure-html/get_summary-1.png" width="700"></p>
<p>We see that model F is the best supported model. This model notably
does not include a link between monogamy and cooperative breeding,
giving support to the direct benefits hypothesis.</p>
</div>
<div class="section level4">
<h4 id="evaluating-variable-importance">Evaluating variable importance<a class="anchor" aria-label="anchor" href="#evaluating-variable-importance"></a>
</h4>
<p>Now that we have selected F as our best model, we still have three
factors that affect cooperative breeding: diet, social grouping and
parental care. Which one is more important? For this we can fit the
model and look at magnitude of the coefficients. In this case, since we
want to use the best model we use the function <code><a href="../reference/best.html">best()</a></code>. One
can use <code><a href="../reference/choice.html">choice()</a></code> to choose any arbitrary model, or
<code><a href="../reference/average.html">average()</a></code> to average over several models.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_cichlids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/best.html">best</a></span><span class="op">(</span><span class="va">cichlids_results</span><span class="op">)</span></span></code></pre></div>
<p>To see the individual coefficients and their standard errors, simply
print <code>best_cichlids</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_cichlids</span></span></code></pre></div>
<pre><code><span><span class="co">## $coef</span></span>
<span><span class="co">##   G M        P D        C</span></span>
<span><span class="co">## G 0 0 2.244975 0 4.488997</span></span>
<span><span class="co">## M 0 0 2.879175 0 0.000000</span></span>
<span><span class="co">## P 0 0 0.000000 0 3.415208</span></span>
<span><span class="co">## D 0 0 0.000000 0 3.415140</span></span>
<span><span class="co">## C 0 0 0.000000 0 0.000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $se</span></span>
<span><span class="co">##   G M         P D        C</span></span>
<span><span class="co">## G 0 0 0.8132303 0 1.200057</span></span>
<span><span class="co">## M 0 0 0.8602750 0 0.000000</span></span>
<span><span class="co">## P 0 0 0.0000000 0 1.348669</span></span>
<span><span class="co">## D 0 0 0.0000000 0 1.376391</span></span>
<span><span class="co">## C 0 0 0.0000000 0 0.000000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "fitted_DAG"</span></span></code></pre>
<p>Or plot those:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/coef_plot.html">coef_plot</a></span><span class="op">(</span><span class="va">best_cichlids</span>, error_bar <span class="op">=</span> <span class="st">"se"</span>, reverse_order <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="binary_models_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>But we can also plot the final model:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">best_cichlids</span><span class="op">)</span></span></code></pre></div>
<p><img src="binary_models_files/figure-html/unnamed-chunk-4-1.png" width="600px" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Wouter van der Bijl.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
